<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRM 後台管理</title>
<style>
body {
	margin: 0;
	font-family: Arial, sans-serif;
	background-color: #f7f8fc;
}

.container {
	display: flex;
}

/* Sidebar 样式 */
.sidebar {
	width: 250px;
	background-color: #5c5fbe;
	padding: 20px;
	color: white;
	height: 100vh;
}

.sidebar h2 {
	color: #fff;
	font-size: 24px;
	text-align: center;
}

.sidebar ul {
	list-style: none;
	padding: 0;
}

.sidebar ul li {
	padding: 15px 10px;
	cursor: pointer;
}

.sidebar ul li:hover {
	background-color: #494ca8;
}

/* 主体内容样式 */
.content {
	flex-grow: 1;
	padding: 20px;
	background-color: #eaeef7;
}

.content h1 {
	font-size: 24px;
	color: #333;
}

.search-box {
	margin-bottom: 20px;
}

.search-box input {
	padding: 10px;
	width: 300px;
	border: 1px solid #ccc;
	border-radius: 5px;
}

.crm-data {
	background-color: #fff;
	padding: 20px;
	border-radius: 10px;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

table {
	width: 100%;
	border-collapse: collapse;
	margin-top: 20px;
}

table, th, td {
	border: 1px solid #ddd;
}

th, td {
	padding: 10px;
	text-align: left;
}

th {
	background-color: #f4f4f4;
	font-weight: bold;
}

button {
	background-color: #5c5fbe;
	color: white;
	border: none;
	padding: 5px 10px;
	cursor: pointer;
	border-radius: 5px;
}

button:hover {
	background-color: #494ca8;
}

#updateForm {
	margin-top: 20px;
}

#updateForm input {
	display: block;
	margin: 10px 0;
	padding: 8px;
	width: 100%;
	border: 1px solid #ccc;
	border-radius: 5px;
}

#updateForm button {
	background-color: #5c5fbe;
	color: white;
	border: none;
	padding: 10px;
	cursor: pointer;
	border-radius: 5px;
}

#updateForm button:hover {
	background-color: #494ca8;
}
</style>
</head>

<body>

	<div class="container">
		<!-- Sidebar 区域 -->
		<div class="sidebar">
			<h2>W2W 後台管理</h2>
			<ul>
				<li>總覽</li>
				<li>用户管理</li>
				<li>商品管理</li>
				<li>訂單管理</li>
				<li>内容管理</li>
				<li>支付與服務管理</li>
				<li>客服管理</li>
			</ul>
		</div>

		<!-- 主体内容区域 -->
		<div class="content">
			<h1>CRM 會員查詢</h1>
			<div class="search-box">
				<input type="text" id="searchKey" placeholder="請輸入ID或account">
				<button type="button" onclick="fetchData()">搜索</button>
			</div>
			<div class="crm-data" id="crmData">
				<!-- 数据表格会在这里生成 -->
				</div>
			<div class="pagination" id="pagination"></div>
    			<!-- 分页控件会在这里生成 -->
			</div>
		</div>
	


	<!-- 修改数据的表单 -->
	<div id="updateForm" style="display: none;">
		<h2>修改数据</h2>
		<form id="updateMemberForm">
			<input type="hidden" id="updateId"> <label
				for="updateAccount">Account:</label> <input type="text"
				id="updateAccount"> <label for="updatePasswd">Password:</label>
			<input type="text" id="updatePasswd"> <label
				for="updatePhone">Phone:</label> <input type="text" id="updatePhone">
			<label for="updateAddr">Address:</label> <input type="text"
				id="updateAddr">
			<button type="button" onclick="updateMember()">提交</button>
		</form>
	</div>

	<script>
	function fetchData(page = 1) {
	    const searchKey = document.getElementById('searchKey').value;
	    const url = `/RCWeb/finaltt?key=${encodeURIComponent(searchKey)}&page=${page}`;

	    fetch(url)
	        .then(response => {
	            if (!response.ok) {
	                throw new Error(`Network response was not ok. Status: ${response.status}`);
	            }
	            return response.json();
	        })
	        .then(data => {
	            const crmDataDiv = document.getElementById('crmData');
	            let tableHtml = `
	                <table>
	                    <thead>
	                        <tr>
	                            <th>ID</th>
	                            <th>Account</th>
	                            <th>Password</th>
	                            <th>Phone</th>
	                            <th>Address</th>
	                            <th>Actions</th>
	                        </tr>
	                    </thead>
	                    <tbody>
	            `;

	            data.results.forEach(member => {
	                tableHtml += `
	                    <tr>
	                        <td>${member.id}</td>
	                        <td>${member.account}</td>
	                        <td>${member.passwd}</td>
	                        <td>${member.phone}</td>
	                        <td>${member.addr}</td>
	                        <td>
	                            <button onclick="showUpdateForm(${member.id}, '${member.account}', '${member.passwd}', '${member.phone}', '${member.addr}')">Edit</button>
	                            <button onclick="deleteMember(${member.id})">Delete</button>
	                        </td>
	                    </tr>
	                `;
	            });

	            tableHtml += `
	                    </tbody>
	                </table>
	            `;

	            crmDataDiv.innerHTML = tableHtml;
	            // 更新分页控件
	            updatePagination(data.totalPages, data.currentPage);
	        })
	        .catch(error => console.error('Error fetching data:', error));
	}

	function updatePagination(totalPages, currentPage) {
	    const paginationDiv = document.getElementById('pagination');
	    let paginationHtml = '';

	    if (totalPages > 1) {
	        if (currentPage > 1) {
	            paginationHtml += `<a href="#" onclick="fetchData(${currentPage - 1})">上一頁</a> `;
	        }
	        
	        for (let i = 1; i <= totalPages; i++) {
	            if (i === currentPage) {
	                paginationHtml += `<span>${i}</span> `;
	            } else {
	                paginationHtml += `<a href="#" onclick="fetchData(${i})">${i}</a> `;
	            }
	        }

	        if (currentPage < totalPages) {
	            paginationHtml += `<a href="#" onclick="fetchData(${currentPage + 1})">下一頁</a> `;
	        }
	    }

	    paginationDiv.innerHTML = paginationHtml;
	}

	// 初始化数据加载
	fetchData(1);

        function showUpdateForm(id, account, passwd, phone, addr) {
            document.getElementById('updateId').value = id;
            document.getElementById('updateAccount').value = account;
            document.getElementById('updatePasswd').value = passwd;
            document.getElementById('updatePhone').value = phone;
            document.getElementById('updateAddr').value = addr;

            document.getElementById('updateForm').style.display = 'block';
        }

        function updateMember() {
            const id = document.getElementById('updateId').value;
            const account = document.getElementById('updateAccount').value;
            const passwd = document.getElementById('updatePasswd').value;
            const phone = document.getElementById('updatePhone').value;
            const addr = document.getElementById('updateAddr').value;

            fetch('/RCWeb/finalupdate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    'id': id,
                    'account': account,
                    'passwd': passwd,
                    'phone': phone,
                    'addr': addr
                })
            })
            .then(response => {
                if (response.ok) {
                    alert('Member updated successfully');
                    document.getElementById('updateForm').style.display = 'none';
                    fetchData(); // Refresh the data
                } else {
                    alert('Failed to update member');
                }
            })
            .catch(error => console.error('Error updating member:', error));
        }

        function deleteMember(id) {
            fetch('/RCWeb/finaldel', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    'id': id
                })
            })
            .then(response => {
                if (response.ok) {
                    alert('Member deleted successfully');
                    fetchData(); // Refresh the data
                } else {
                    alert('Failed to delete member');
                }
            })
            .catch(error => console.error('Error deleting member:', error));
        }


    </script>

</body>
</html>